<!DOCTYPE html>
<html class="wide wow-animation" lang="zh-CN">
  <head>
    <!-- ç½‘ç«™æ ‡é¢˜-->
    <title>ç”¨æˆ·ç™»å½• - åè½©ä¹¦åº—</title>
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <!-- æ ·å¼è¡¨-->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:700%7CLato:300,400,300italic,700">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/fonts.css">
    <!-- å®æ—¶æ•°æ®ç³»ç»Ÿæ ·å¼ -->
    <link rel="stylesheet" href="css/realtime-ui.css">

    <!-- ç™»å½•é¡µé¢ä¸“ç”¨æ ·å¼ -->
    <style>
      /* ä¿®å¤æµ®åŠ¨æ ‡ç­¾é‡åˆé—®é¢˜ */
      .form-wrap {
        position: relative;
        margin-bottom: 25px;
      }

      .form-label {
        position: absolute;
        left: 15px;
        top: 15px;
        font-size: 16px;
        color: #666;
        pointer-events: none;
        transition: all 0.3s ease;
        background: #f8f9fa;
        padding: 0 5px;
        z-index: 1;
      }

      /* å½“è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æˆ–æœ‰å†…å®¹æ—¶ï¼Œæ ‡ç­¾ä¸Šç§» */
      .form-input:focus + .form-label,
      .form-input:not(:placeholder-shown) + .form-label,
      .form-input.has-value + .form-label {
        top: -8px;
        left: 10px;
        font-size: 12px;
        color: #007bff;
        background: white;
      }

      /* ç¡®ä¿è¾“å…¥æ¡†æœ‰å†…å®¹æ—¶æ ‡ç­¾ä¿æŒä¸Šç§»çŠ¶æ€ */
      .form-input:valid + .form-label {
        top: -8px;
        left: 10px;
        font-size: 12px;
        color: #007bff;
        background: white;
      }

      /* è¾“å…¥æ¡†æ ·å¼ä¼˜åŒ– */
      .form-input {
        position: relative;
        z-index: 0;
      }

      .form-input:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
      }
    </style>
		<!--[if lt IE 10]>
    <div style="background: #212121; padding: 10px 0; box-shadow: 3px 3px 5px 0 rgba(0,0,0,.3); clear: both; text-align:center; position: relative; z-index:1;"><a href="http://windows.microsoft.com/en-US/internet-explorer/"><img src="images/ie8-panel/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="æ‚¨æ­£åœ¨ä½¿ç”¨è¿‡æ—¶çš„æµè§ˆå™¨ã€‚ä¸ºäº†è·å¾—æ›´å¿«æ›´å®‰å…¨çš„æµè§ˆä½“éªŒï¼Œè¯·å…è´¹å‡çº§ã€‚"></a></div>
    <script src="js/html5shiv.min.js"></script>
		<![endif]-->
  </head>
  <body>
    <!-- Page preloader-->
    <div class="page-loader">
      <div class="page-loader-body">
        <div class="preloader-wrapper big active">
          <div class="spinner-layer spinner-primary">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div>
            <div class="gap-patch">
              <div class="circle"> </div>
            </div>
            <div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>
          <div class="spinner-layer spinner-primary">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div>
            <div class="gap-patch">
              <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>
          <div class="spinner-layer spinner-primary">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div>
            <div class="gap-patch">
              <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>
          <div class="spinner-layer spinner-primary">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div>
            <div class="gap-patch">
              <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Page-->
    <div class="page">
      <!-- Page Header-->
      <header class="section page-header">
        <!-- RD Navbar-->
        <div class="rd-navbar-wrap rd-navbar-centered">
          <nav class="rd-navbar novi-background" data-layout="rd-navbar-fixed" data-sm-layout="rd-navbar-fixed" data-md-layout="rd-navbar-fixed" data-md-device-layout="rd-navbar-fixed" data-lg-layout="rd-navbar-fullwidth" data-lg-device-layout="rd-navbar-fixed" data-xl-layout="rd-navbar-static" data-xl-device-layout="rd-navbar-static" data-md-stick-up-offset="1px" data-lg-stick-up-offset="1px" data-stick-up="true" data-sm-stick-up="true" data-md-stick-up="true" data-lg-stick-up="true" data-xl-stick-up="true">
            <div class="rd-navbar-inner">
              <div class="rd-navbar-aside-left">
                <div class="rd-navbar-nav-wrap">
                  <!-- RD Navbar Nav-->
                  <ul class="rd-navbar-nav">
                    <li><a href="index.html">é¦–é¡µ</a></li>
                    <li><a href="#">å›¾ä¹¦åˆ†ç±»</a>
                      <!-- RD Navbar Dropdown-->
                      <ul class="rd-navbar-dropdown">
                        <li><a href="category.html?type=business">å•†ä¸šç®¡ç†</a></li>
                        <li><a href="category.html?type=technology">ç§‘æŠ€è®¡ç®—æœº</a></li>
                        <li><a href="category.html?type=literature">æ–‡å­¦è‰ºæœ¯</a></li>
                        <li><a href="category.html?type=education">æ•™è‚²è€ƒè¯•</a></li>
                        <li><a href="category.html?type=children">å°‘å„¿è¯»ç‰©</a></li>
                        <li><a href="category.html?type=life">ç”Ÿæ´»ä¼‘é—²</a></li>
                        <li><a href="category.html?type=social">ç¤¾ä¼šç§‘å­¦</a></li>
                      </ul>
                    </li>
                    <li><a href="recommendations.html">ä¸ºæ‚¨æ¨è</a></li>
                    <li><a href="forum.html">è¯»è€…è®ºå›</a></li>
                  </ul>
                </div>
              </div>
              <!-- RD Navbar Panel-->
              <div class="rd-navbar-panel">
                <button class="rd-navbar-toggle" data-rd-navbar-toggle=".rd-navbar-nav-wrap"><span></span></button>
                <!-- RD Navbar Brand-->
                <div class="rd-navbar-brand">
                  <a class="brand-name" href="index.html">
                    <img class="logo-default" src="images/logo-default-161x57.png" alt="åè½©ä¹¦åº—" width="161" height="57"/>
                    <img class="logo-inverse" src="images/logo-inverse-161x57.png" alt="åè½©ä¹¦åº—" width="161" height="57"/>
                  </a>
                </div>
              </div>
              <div class="rd-navbar-collapse-toggle" data-rd-navbar-toggle=".rd-navbar-collapse"><span></span></div>
              <div class="rd-navbar-aside-right rd-navbar-collapse">
                <!-- RD Navbar Search-->
                <div class="rd-navbar-search">
                  <a class="rd-navbar-search-toggle" data-rd-navbar-toggle=".rd-navbar-search" href="#"><span></span></a>
                  <form class="rd-search" action="search-results.html" data-search-live="rd-search-results-live" method="GET">
                    <div class="form-wrap">
                      <label class="form-label form-label" for="rd-navbar-search-form-input">æœç´¢å›¾ä¹¦...</label>
                      <input class="rd-navbar-search-form-input form-input" id="rd-navbar-search-form-input" type="text" name="keyword" autocomplete="off">
                      <div class="rd-search-results-live"></div>
                    </div>
                    <button class="rd-search-form-submit mdi mdi-magnify"></button>
                  </form>
                </div>
                <!-- User Menu -->
                <div class="rd-navbar-user">
                  <a href="login-page.html" class="user-icon" id="userMenu">
                    <i class="mdi mdi-account"></i>
                    <span id="userDisplayName">ç™»å½•</span>
                  </a>
                  <div class="user-dropdown" id="userDropdown" style="display: none;">
                    <a href="user-profile.html">ä¸ªäººèµ„æ–™</a>
                    <a href="order-history.html">æˆ‘çš„è®¢å•</a>
                    <a href="browsing-history.html">æµè§ˆå†å²</a>
                    <a href="user-preferences.html">åå¥½è®¾ç½®</a>
                    <a href="change-password.html">ä¿®æ”¹å¯†ç </a>
                    <a href="#" onclick="logout()">é€€å‡ºç™»å½•</a>
                  </div>
                </div>
                <!-- Shopping Cart -->
                <div class="rd-navbar-cart">
                  <a href="shopping-cart.html" class="cart-icon" id="cartIcon">
                    <i class="mdi mdi-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                  </a>
                </div>
              </div>
            </div>
          </nav>
        </div>
      </header>
      <section class="single-screen section fullwidth-page">
        <div class="fullwidth-page-inner" style="display: flex; align-items: flex-start; justify-content: center; min-height: 100vh; padding-top: 90px;">
          <div class="section-md" style="width: 100%;">
            <div class="container">
              <div class="row">
                <div class="col-md-10 col-lg-8 col-xl-6" style="margin-left: 35%;">
                  <div class="card" style="padding: 60px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08);">
                    <h3 class="text-primary mb-4" style="margin-bottom: 40px; font-size: 28px;">ç”¨æˆ·ç™»å½•</h3>
                    <!-- RD Mailform-->
                    <form class="rd-mailform form-fix" id="loginForm" method="POST" action="#" style="margin-top: 30px;">
                      <div class="form-wrap form-wrap-validation">
                        <input class="form-input" id="forms-login-email" type="email" name="email" data-constraints="@Required @Email" style="background: #f8f9fa; font-size: 16px; padding: 15px;">
                        <label class="form-label" for="forms-login-email">ç”µå­é‚®ç®±</label>
                      </div>
                      <div class="form-wrap form-wrap-validation">
                        <input class="form-input" id="forms-login-password" type="password" name="password" data-constraints="@Required" style="background: #f8f9fa; font-size: 16px; padding: 15px;">
                        <label class="form-label" for="forms-login-password">å¯†ç </label>
                      </div>
                      <div class="form-wrap text-left">
                        <div class="checkbox-inline">
                          <label class="checkbox-inline__label" style="font-size: 16px;">
                            <input class="checkbox-inline__input" type="checkbox" name="remember" value="yes">
                            <span class="checkbox-inline__box"></span>è®°ä½æˆ‘
                          </label>
                        </div>
                      </div>
                      <div class="form-wrap">
                        <button class="button button-block button-primary" type="submit" style="font-size: 18px; padding: 15px;">ç™»å½•</button>
                      </div>
                      <div class="form-wrap text-center" style="margin-top: 25px;">
                        <p style="font-size: 16px;">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ <a href="registration-page.html">ç«‹å³æ³¨å†Œ</a></p>
                        <p style="font-size: 16px;"><a href="forgot-password.html">å¿˜è®°å¯†ç ï¼Ÿ</a></p>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="fullwidth-page-footer text-center">
          <p class="rights"><span>&copy;&nbsp;</span><span class="copyright-year"></span><span>&nbsp;</span><span>åè½©ä¹¦åº—</span><span>. ä¿ç•™æ‰€æœ‰æƒåˆ©.</span></p>
        </div>
      </section>
    </div>
    <!-- Global Mailform Output-->
    <div class="snackbars" id="form-output-global"></div>
    <!-- Javascript-->
    <script src="js/core.min.js"></script>
    <script src="js/script.js"></script>

    <!-- å®æ—¶æ•°æ®ç³»ç»Ÿè„šæœ¬ -->
    <script src="js/realtime-data-manager.js"></script>
    <script src="js/page-adapters.js"></script>

    <!-- å¼ºåˆ¶ç™»å½•ä¿®å¤è„šæœ¬ -->
    <script>
        console.log('ğŸ” ç™»å½•é¡µé¢åŠ è½½å®Œæˆ');

        // å¼ºåˆ¶ç»‘å®šç™»å½•åŠŸèƒ½ - å¤šé‡ä¿é™©
        function forceBindLogin() {
            const loginForm = document.getElementById('loginForm');
            const submitBtn = loginForm ? loginForm.querySelector('button[type="submit"]') : null;

            console.log('ğŸ”§ å¼ºåˆ¶ç»‘å®šç™»å½•åŠŸèƒ½');
            console.log('- loginForm:', !!loginForm);
            console.log('- submitBtn:', !!submitBtn);

            if (!loginForm) {
                console.error('âŒ æœªæ‰¾åˆ°ç™»å½•è¡¨å•');
                return;
            }

            // ç§»é™¤æ‰€æœ‰ç°æœ‰çš„äº‹ä»¶ç›‘å¬å™¨
            const newForm = loginForm.cloneNode(true);
            loginForm.parentNode.replaceChild(newForm, loginForm);

            // é‡æ–°è·å–å…ƒç´ 
            const form = document.getElementById('loginForm');
            const newSubmitBtn = form.querySelector('button[type="submit"]');

            console.log('âœ… è¡¨å•å·²é‡ç½®ï¼Œé‡æ–°ç»‘å®šäº‹ä»¶');

            // ç»‘å®šè¡¨å•æäº¤äº‹ä»¶
            form.addEventListener('submit', handleLogin);

            // ç»‘å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆåŒé‡ä¿é™©ï¼‰
            if (newSubmitBtn) {
                newSubmitBtn.addEventListener('click', function(e) {
                    console.log('ğŸ–±ï¸ ç™»å½•æŒ‰é’®è¢«ç‚¹å‡»');
                    e.preventDefault();
                    handleLogin(e);
                });
            }

            // ç»‘å®šå›è½¦é”®äº‹ä»¶
            form.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    console.log('âŒ¨ï¸ å›è½¦é”®è¢«æŒ‰ä¸‹');
                    e.preventDefault();
                    handleLogin(e);
                }
            });

            console.log('ğŸ¯ æ‰€æœ‰äº‹ä»¶ç»‘å®šå®Œæˆ');
        }

        async function handleLogin(e) {
            e.preventDefault();
            console.log('ğŸ“ ç™»å½•å¤„ç†å‡½æ•°è¢«è°ƒç”¨');

            const email = document.getElementById('forms-login-email').value;
            const password = document.getElementById('forms-login-password').value;
            const remember = document.querySelector('input[name="remember"]');

            console.log('ğŸ“§ ç™»å½•ä¿¡æ¯:', {
                email,
                password: password ? '***' : '(ç©º)',
                remember: remember ? remember.checked : false
            });

            if (!email || !password) {
                alert('è¯·å¡«å†™é‚®ç®±å’Œå¯†ç ');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const submitBtn = document.querySelector('#loginForm button[type="submit"]');
            const originalText = submitBtn ? submitBtn.textContent : '';
            if (submitBtn) {
                submitBtn.textContent = 'ç™»å½•ä¸­...';
                submitBtn.disabled = true;
            }

            try {
                console.log('ğŸ”„ å¼€å§‹APIè°ƒç”¨');

                const response = await fetch('http://1.94.203.175:5000/api/user/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                console.log('ğŸ“¡ APIå“åº”çŠ¶æ€:', response.status);

                const result = await response.json();
                console.log('ğŸ“¥ APIå“åº”æ•°æ®:', result);

                if (result.success) {
                    // ä¿å­˜å®Œæ•´çš„ç™»å½•çŠ¶æ€
                    localStorage.setItem('authToken', result.data.token);
                    localStorage.setItem('token', result.data.token); // å…¼å®¹æ€§
                    localStorage.setItem('userInfo', JSON.stringify(result.data.user));
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('username', result.data.user.username);
                    localStorage.setItem('userEmail', result.data.user.email);

                    console.log('âœ… ç™»å½•æˆåŠŸï¼Œå·²ä¿å­˜ç™»å½•çŠ¶æ€:', {
                        authToken: !!result.data.token,
                        userInfo: result.data.user,
                        isLoggedIn: 'true'
                    });

                    alert('ç™»å½•æˆåŠŸï¼æ­£åœ¨è·³è½¬...');

                    // å»¶è¿Ÿè·³è½¬ï¼Œç¡®ä¿æ•°æ®ä¿å­˜å®Œæˆ
                    setTimeout(() => {
                        console.log('ğŸ”„ å¼€å§‹è·³è½¬åˆ°é¦–é¡µ');
                        window.location.href = 'index.html';
                    }, 1000);
                } else {
                    console.error('âŒ ç™»å½•å¤±è´¥:', result.message);
                    alert('ç™»å½•å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('âŒ ç™»å½•å¼‚å¸¸:', error);
                alert('ç™»å½•å¤±è´¥: ' + error.message);
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                if (submitBtn) {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            }
        }

        // å¤„ç†æµ®åŠ¨æ ‡ç­¾
        function handleFloatingLabels() {
            const inputs = document.querySelectorAll('.form-input');
            inputs.forEach(input => {
                // æ£€æŸ¥è¾“å…¥æ¡†æ˜¯å¦æœ‰å€¼
                function checkValue() {
                    if (input.value.trim() !== '') {
                        input.classList.add('has-value');
                    } else {
                        input.classList.remove('has-value');
                    }
                }

                // åˆå§‹æ£€æŸ¥
                checkValue();

                // ç›‘å¬è¾“å…¥äº‹ä»¶
                input.addEventListener('input', checkValue);
                input.addEventListener('change', checkValue);
                input.addEventListener('blur', checkValue);
            });
        }

        // å¤šé‡åˆå§‹åŒ–ç­–ç•¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ DOMåŠ è½½å®Œæˆ');
            forceBindLogin();
            handleFloatingLabels();
        });

        window.addEventListener('load', function() {
            console.log('ğŸŒ é¡µé¢å®Œå…¨åŠ è½½');
            // å»¶è¿Ÿå†æ¬¡ç»‘å®šï¼Œç¡®ä¿æ‰€æœ‰è„šæœ¬éƒ½åŠ è½½å®Œæˆ
            setTimeout(forceBindLogin, 1000);
        });

        // å¦‚æœå…¶ä»–æ–¹æ³•éƒ½å¤±è´¥ï¼Œ3ç§’åå¼ºåˆ¶ç»‘å®š
        setTimeout(function() {
            console.log('â° 3ç§’åå¼ºåˆ¶æ£€æŸ¥');
            const form = document.getElementById('loginForm');
            if (form && !form.hasAttribute('data-force-bound')) {
                console.log('ğŸš¨ æ‰§è¡Œæœ€åçš„å¼ºåˆ¶ç»‘å®š');
                form.setAttribute('data-force-bound', 'true');
                forceBindLogin();
            }
        }, 3000);
    </script>
  </body>
</html>