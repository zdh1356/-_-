<!DOCTYPE html>
<html class="wide wow-animation" lang="zh-CN">
  <head>
    <title>è¯»è€…è®ºå› - åè½©ä¹¦åº—</title>
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <!-- Stylesheets-->
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Montserrat:400,500,600,700%7CPoppins:400%7CTeko:300,400">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/fonts.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
      .ie-panel{display: none;background: #212121;padding: 10px 0;box-shadow: 3px 3px 5px 0 rgba(0,0,0,.3);clear: both;text-align:center;position: relative;z-index: 1;} html.ie-10 .ie-panel, html.lt-ie-10 .ie-panel {display: block;}
    </style>
  </head>
  <body>
    <div class="ie-panel"><a href="http://windows.microsoft.com/en-US/internet-explorer/"><img src="images/ie8-panel/warning_bar_0000_us.jpg" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today."></a></div>
    <div class="preloader">
      <div class="preloader-body">
        <div class="cssload-container">
          <div class="cssload-speeding-wheel"></div>
        </div>
        <p>Loading...</p>
      </div>
    </div>
    <!-- Page-->
    <div class="page">
      <!-- Page Header-->
      <header class="section page-header">
        <!-- RD Navbar-->
        <div class="rd-navbar-wrap rd-navbar-centered">
          <nav class="rd-navbar novi-background" data-layout="rd-navbar-fixed" data-sm-layout="rd-navbar-fixed" data-md-layout="rd-navbar-fixed" data-md-device-layout="rd-navbar-fixed" data-lg-layout="rd-navbar-fullwidth" data-lg-device-layout="rd-navbar-fixed" data-xl-layout="rd-navbar-static" data-xl-device-layout="rd-navbar-static" data-md-stick-up-offset="1px" data-lg-stick-up-offset="1px" data-stick-up="true" data-sm-stick-up="true" data-md-stick-up="true" data-lg-stick-up="true" data-xl-stick-up="true">
            <div class="rd-navbar-inner">
              <div class="rd-navbar-aside-left">
                <div class="rd-navbar-nav-wrap">
                  <!-- RD Navbar Nav-->
                  <ul class="rd-navbar-nav">
                    <li><a href="index.html">é¦–é¡µ</a></li>
                    <li><a href="#">å›¾ä¹¦åˆ†ç±»</a>
                      <!-- RD Navbar Dropdown-->
                      <ul class="rd-navbar-dropdown">
                        <li><a href="category.html?type=business">å•†ä¸šç®¡ç†</a></li>
                        <li><a href="category.html?type=technology">ç§‘æŠ€è®¡ç®—æœº</a></li>
                        <li><a href="category.html?type=literature">æ–‡å­¦è‰ºæœ¯</a></li>
                        <li><a href="category.html?type=education">æ•™è‚²è€ƒè¯•</a></li>
                        <li><a href="category.html?type=children">å°‘å„¿è¯»ç‰©</a></li>
                        <li><a href="category.html?type=life">ç”Ÿæ´»ä¼‘é—²</a></li>
                        <li><a href="category.html?type=social">ç¤¾ä¼šç§‘å­¦</a></li>
                      </ul>
                    </li>
                    <li><a href="recommendations.html">ä¸ºæ‚¨æ¨è</a></li>
                    <li class="active"><a href="forum.html">è¯»è€…è®ºå›</a></li>
                  </ul>
                </div>
              </div>
              <!-- RD Navbar Panel-->
              <div class="rd-navbar-panel">
                <button class="rd-navbar-toggle" data-rd-navbar-toggle=".rd-navbar-nav-wrap"><span></span></button>
                <!-- RD Navbar Brand-->
                <div class="rd-navbar-brand"><a class="brand-name" href="index.html"><img class="logo-default" src="images/logo-default-161x57.png" alt="åè½©ä¹¦åº—" width="161" height="57"/><img class="logo-inverse" src="images/logo-inverse-161x57.png" alt="åè½©ä¹¦åº—" width="161" height="57"/></a></div>
              </div>
              <div class="rd-navbar-collapse-toggle" data-rd-navbar-toggle=".rd-navbar-collapse"><span></span></div>
              <div class="rd-navbar-aside-right rd-navbar-collapse">
                <!-- RD Navbar Search-->
                <div class="rd-navbar-search"><a class="rd-navbar-search-toggle" data-rd-navbar-toggle=".rd-navbar-search" href="#"><span></span></a>
                  <form class="rd-search" action="search-results.html" data-search-live="rd-search-results-live" method="GET">
                    <div class="form-wrap">
                      <label class="form-label form-label" for="rd-navbar-search-form-input">æœç´¢å›¾ä¹¦...</label>
                      <input class="rd-navbar-search-form-input form-input" id="rd-navbar-search-form-input" type="text" name="keyword" autocomplete="off">
                      <div class="rd-search-results-live"></div>
                    </div>
                    <button class="rd-search-form-submit mdi mdi-magnify"></button>
                  </form>
                </div>
                <!-- User Menu -->
                <div class="rd-navbar-user">
                  <a href="login-page.html" class="user-icon" id="userMenu">
                    <i class="mdi mdi-account"></i>
                    <span id="userDisplayName">ç™»å½•</span>
                  </a>
                  <div class="user-dropdown" id="userDropdown" style="display: none;">
                    <a href="user-profile.html">ä¸ªäººèµ„æ–™</a>
                    <a href="order-history.html">æˆ‘çš„è®¢å•</a>
                    <a href="browsing-history.html">æµè§ˆå†å²</a>
                    <a href="user-preferences.html">åå¥½è®¾ç½®</a>
                    <a href="change-password.html">ä¿®æ”¹å¯†ç </a>
                    <a href="#" onclick="logout()">é€€å‡ºç™»å½•</a>
                  </div>
                </div>
                <!-- Shopping Cart -->
                <div class="rd-navbar-cart">
                  <a href="shopping-cart.html" class="cart-icon" id="cartIcon">
                    <i class="mdi mdi-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                  </a>
                </div>
              </div>
            </div>
          </nav>
        </div>
      </header>

      <!-- Breadcrumbs-->
      <section class="breadcrumbs-custom" style="background-image: url(images/breadcrumbs-bg.jpg)">
        <div class="container">
          <p class="breadcrumbs-custom-subtitle">äº¤æµåˆ†äº«</p>
          <p class="heading-1 breadcrumbs-custom-title">è¯»è€…è®ºå›</p>
          <ul class="breadcrumbs-custom-path">
            <li><a href="index.html">é¦–é¡µ</a></li>
            <li class="active">è¯»è€…è®ºå›</li>
          </ul>
        </div>
      </section>

      <!-- Forum Section -->
      <section class="section section-lg bg-default">
        <div class="container">
          <div class="row">
            <!-- Forum Categories Sidebar -->
            <div class="col-lg-3">
              <div class="forum-sidebar">
                <h5>è®ºå›åˆ†ç±»</h5>
                <ul class="forum-categories">
                  <li><a href="#" class="category-link active" data-category="all">å…¨éƒ¨å¸–å­</a></li>
                  <li><a href="#" class="category-link" data-category="review">ä¹¦è¯„æ¨è</a></li>
                  <li><a href="#" class="category-link" data-category="discussion">è¯»ä¹¦è®¨è®º</a></li>
                  <li><a href="#" class="category-link" data-category="complaint">æ„è§æŠ•è¯‰</a></li>
                  <li><a href="#" class="category-link" data-category="suggestion">å»ºè®®åé¦ˆ</a></li>
                </ul>

                <div class="forum-stats">
                  <h6>è®ºå›ç»Ÿè®¡</h6>
                  <div class="stat-item">
                    <span class="stat-label">æ€»å¸–å­æ•°ï¼š</span>
                    <span class="stat-value" id="totalPosts">0</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">ä»Šæ—¥æ–°å¸–ï¼š</span>
                    <span class="stat-value" id="todayPosts">0</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">æ´»è·ƒç”¨æˆ·ï¼š</span>
                    <span class="stat-value">156</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Main Forum Content -->
            <div class="col-lg-9">
              <!-- New Post Form -->
              <div class="card mb-4" id="newPostForm" style="display: none;">
                <div class="card-header">
                  <h5>å‘è¡¨æ–°å¸–</h5>
                </div>
                <div class="card-body">
                  <form id="postForm">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-wrap">
                          <select class="form-input" id="postCategory" name="category" required>
                            <option value="">é€‰æ‹©åˆ†ç±»</option>
                            <option value="review">ä¹¦è¯„æ¨è</option>
                            <option value="discussion">è¯»ä¹¦è®¨è®º</option>
                            <option value="complaint">æ„è§æŠ•è¯‰</option>
                            <option value="suggestion">å»ºè®®åé¦ˆ</option>
                          </select>
                          <label class="form-label" for="postCategory">å¸–å­åˆ†ç±»</label>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-wrap">
                          <input class="form-input" id="postTitle" type="text" name="title" required>
                          <label class="form-label" for="postTitle">å¸–å­æ ‡é¢˜</label>
                        </div>
                      </div>
                    </div>
                    <div class="form-wrap">
                      <textarea class="form-input" id="postContent" name="content" rows="6" required></textarea>
                      <label class="form-label" for="postContent">å¸–å­å†…å®¹</label>
                    </div>
                    <div class="form-actions">
                      <button type="submit" class="button button-primary">å‘è¡¨å¸–å­</button>
                      <button type="button" class="button button-default" onclick="hideNewPostForm()">å–æ¶ˆ</button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Forum Header -->
              <div class="forum-header">
                <div class="d-flex justify-content-between align-items-center">
                  <h4 id="forumTitle">å…¨éƒ¨å¸–å­</h4>
                  <button class="button button-primary" onclick="showNewPostForm()" id="newPostBtn">å‘è¡¨æ–°å¸–</button>
                </div>
                <div class="forum-sort">
                  <label>æ’åºæ–¹å¼ï¼š</label>
                  <select id="sortSelect" class="form-control">
                    <option value="latest">æœ€æ–°å‘å¸ƒ</option>
                    <option value="popular">æœ€å¤šå›å¤</option>
                    <option value="oldest">æœ€æ—©å‘å¸ƒ</option>
                  </select>
                </div>
              </div>

              <!-- Posts List -->
              <div id="postsList">
                <!-- å¸–å­åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
              </div>

              <!-- Pagination -->
              <div class="pagination-wrap text-center mt-4" id="paginationWrap" style="display: none;">
                <nav aria-label="Forum pagination">
                  <ul class="pagination" id="pagination">
                    <!-- åˆ†é¡µå°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Global Mailform Output-->
    <div class="snackbars" id="form-output-global"></div>
    <!-- Javascript-->
    <script src="js/core.min.js"></script>
    <script src="js/script.js"></script>

    <!-- Forum Scripts -->
    <script>
      // é‚®ä»¶æœåŠ¡APIé…ç½®
      const EMAIL_API_BASE = 'http://127.0.0.1:5000/api/email';

      // æ¨¡æ‹Ÿè®ºå›å¸–å­æ•°æ®
      let forumPosts = [
        {
          id: 1,
          title: 'ã€Šç™¾å¹´å­¤ç‹¬ã€‹è¯»åæ„Ÿ - é­”å¹»ç°å®ä¸»ä¹‰çš„é­…åŠ›',
          content: 'åˆšåˆšè¯»å®Œã€Šç™¾å¹´å­¤ç‹¬ã€‹ï¼Œè¢«é©¬å°”å…‹æ–¯çš„é­”å¹»ç°å®ä¸»ä¹‰æ·±æ·±éœ‡æ’¼ã€‚å¸ƒæ©è¿ªäºšå®¶æ—ä¸ƒä»£äººçš„æ•…äº‹ï¼Œæ—¢æ˜¯ä¸ªäººå‘½è¿çš„å†™ç…§ï¼Œä¹Ÿæ˜¯æ‹‰ä¸ç¾æ´²å†å²çš„ç¼©å½±ã€‚ä¹¦ä¸­çš„å­¤ç‹¬æ„Ÿè´¯ç©¿å§‹ç»ˆï¼Œè®©äººæ·±æ€...',
          author: 'æ–‡å­¦çˆ±å¥½è€…',
          category: 'review',
          date: '2024-01-28',
          replies: 12,
          views: 156,
          likes: 23
        },
        {
          id: 2,
          title: 'å…³äºç½‘ç«™å›¾ä¹¦åˆ†ç±»çš„å»ºè®®',
          content: 'å¸Œæœ›ç½‘ç«™èƒ½å¢åŠ æ›´å¤šçš„å›¾ä¹¦åˆ†ç±»ï¼Œæ¯”å¦‚å¿ƒç†å­¦ã€å“²å­¦ç­‰ã€‚ç°åœ¨çš„åˆ†ç±»è¿˜ä¸å¤Ÿç»†è‡´ï¼ŒæŸ¥æ‰¾å›¾ä¹¦æ—¶ä¸å¤ªæ–¹ä¾¿ã€‚å¦å¤–å»ºè®®å¢åŠ å›¾ä¹¦æ¨èåŠŸèƒ½ï¼Œæ ¹æ®ç”¨æˆ·çš„è´­ä¹°å†å²æ¨èç›¸å…³å›¾ä¹¦ã€‚',
          author: 'ä¹¦è™«å°ç‹',
          category: 'suggestion',
          date: '2024-01-27',
          replies: 8,
          views: 89,
          likes: 15
        },
        {
          id: 3,
          title: 'è®¢å•é…é€é—®é¢˜æŠ•è¯‰',
          content: 'æˆ‘çš„è®¢å•ORD001å·²ç»ä¸‹å•ä¸€å‘¨äº†ï¼Œä½†æ˜¯ç‰©æµä¿¡æ¯ä¸€ç›´æ²¡æœ‰æ›´æ–°ã€‚å®¢æœä¹Ÿè”ç³»ä¸ä¸Šï¼Œå¸Œæœ›èƒ½å°½å¿«å¤„ç†ã€‚è®¢å•ä¸­çš„ã€Šé¢†å¯¼åŠ›è‰ºæœ¯ã€‹æˆ‘å¾ˆæ€¥éœ€ï¼Œè¯·å¸®å¿™å‚¬ä¿ƒä¸€ä¸‹å¿«é€’å…¬å¸ã€‚',
          author: 'ç€æ€¥çš„è¯»è€…',
          category: 'complaint',
          date: '2024-01-26',
          replies: 5,
          views: 67,
          likes: 3
        },
        {
          id: 4,
          title: 'æ¨èå‡ æœ¬ä¼˜ç§€çš„ç¼–ç¨‹å…¥é—¨ä¹¦ç±',
          content: 'ä½œä¸ºä¸€åç¨‹åºå‘˜ï¼Œæˆ‘æƒ³æ¨èå‡ æœ¬éå¸¸é€‚åˆåˆå­¦è€…çš„ç¼–ç¨‹ä¹¦ç±ï¼š1.ã€ŠPythonç¼–ç¨‹ä»å…¥é—¨åˆ°å®è·µã€‹2.ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹3.ã€Šç®—æ³•å¯¼è®ºã€‹ã€‚è¿™äº›ä¹¦éƒ½å¾ˆå®ç”¨ï¼Œé€‚åˆä¸åŒé˜¶æ®µçš„å­¦ä¹ è€…ã€‚',
          author: 'ç¨‹åºå‘˜å°æ',
          category: 'review',
          date: '2024-01-25',
          replies: 18,
          views: 234,
          likes: 31
        },
        {
          id: 5,
          title: 'å…³äºã€Šæ´»ç€ã€‹è¿™æœ¬ä¹¦çš„è®¨è®º',
          content: 'æœ€è¿‘åœ¨è¯»ä½™åçš„ã€Šæ´»ç€ã€‹ï¼Œæ„Ÿè§¦å¾ˆæ·±ã€‚ç¦è´µçš„ä¸€ç”Ÿç»å†äº†å¤ªå¤šè‹¦éš¾ï¼Œä½†ä»–ä¾ç„¶åšå¼ºåœ°æ´»ç€ã€‚æƒ³å’Œå¤§å®¶è®¨è®ºä¸€ä¸‹ï¼Œä½ ä»¬è§‰å¾—è¿™æœ¬ä¹¦æƒ³è¦è¡¨è¾¾ä»€ä¹ˆä¸»é¢˜ï¼Ÿç”Ÿå‘½çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ',
          author: 'æ€è€ƒè€…',
          category: 'discussion',
          date: '2024-01-24',
          replies: 22,
          views: 189,
          likes: 28
        },
        {
          id: 6,
          title: 'ç½‘ç«™è´­ç‰©è½¦åŠŸèƒ½æœ‰bug',
          content: 'å‘ç°ç½‘ç«™è´­ç‰©è½¦æœ‰ä¸ªå°é—®é¢˜ï¼Œæ·»åŠ å›¾ä¹¦åæ•°é‡æ˜¾ç¤ºä¸æ­£ç¡®ã€‚åˆ·æ–°é¡µé¢åå°±æ­£å¸¸äº†ã€‚å»ºè®®æŠ€æœ¯å›¢é˜Ÿæ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚å¦å¤–å¸Œæœ›èƒ½å¢åŠ æ”¶è—å¤¹åŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·æ”¶è—æ„Ÿå…´è¶£çš„å›¾ä¹¦ã€‚',
          author: 'ç»†å¿ƒç”¨æˆ·',
          category: 'complaint',
          date: '2024-01-23',
          replies: 3,
          views: 45,
          likes: 7
        }
      ];

      let currentCategory = 'all';
      let currentSort = 'latest';

      // åˆ†ç±»æ–‡æœ¬æ˜ å°„
      const categoryText = {
        'all': 'å…¨éƒ¨å¸–å­',
        'review': 'ä¹¦è¯„æ¨è',
        'discussion': 'è¯»ä¹¦è®¨è®º',
        'complaint': 'æ„è§æŠ•è¯‰',
        'suggestion': 'å»ºè®®åé¦ˆ'
      };

      // æ˜¾ç¤ºå¸–å­åˆ—è¡¨
      function displayPosts(posts = forumPosts) {
        const postsList = document.getElementById('postsList');

        if (posts.length === 0) {
          postsList.innerHTML = `
            <div class="empty-posts">
              <i class="mdi mdi-forum"></i>
              <h5>æš‚æ— å¸–å­</h5>
              <p>è¿˜æ²¡æœ‰ç›¸å…³å¸–å­ï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€ä¸ªå¸–å­å§ï¼</p>
              <button class="button button-primary" onclick="showNewPostForm()">å‘è¡¨æ–°å¸–</button>
            </div>
          `;
          return;
        }

        const postsHTML = posts.map(post => `
          <div class="post-item">
            <div class="post-header">
              <div class="post-category category-${post.category}">
                ${categoryText[post.category]}
              </div>
              <div class="post-meta">
                <span class="post-author">
                  <i class="mdi mdi-account"></i>
                  ${post.author}
                </span>
                <span class="post-date">
                  <i class="mdi mdi-clock"></i>
                  ${post.date}
                </span>
              </div>
            </div>
            <div class="post-content">
              <h5 class="post-title">
                <a href="#" onclick="viewPost(${post.id})">${post.title}</a>
              </h5>
              <p class="post-excerpt">${post.content.substring(0, 150)}...</p>
            </div>
            <div class="post-footer">
              <div class="post-stats">
                <span class="stat-item">
                  <i class="mdi mdi-eye"></i>
                  ${post.views} æµè§ˆ
                </span>
                <span class="stat-item">
                  <i class="mdi mdi-comment"></i>
                  ${post.replies} å›å¤
                </span>
                <span class="stat-item">
                  <i class="mdi mdi-heart"></i>
                  ${post.likes} ç‚¹èµ
                </span>
              </div>
              <div class="post-actions">
                <button class="btn-action" onclick="likePost(${post.id})">
                  <i class="mdi mdi-heart-outline"></i>
                  ç‚¹èµ
                </button>
                <button class="btn-action" onclick="replyPost(${post.id})">
                  <i class="mdi mdi-reply"></i>
                  å›å¤
                </button>
              </div>
            </div>
          </div>
        `).join('');

        postsList.innerHTML = postsHTML;
        updateForumStats();
      }

      // ç­›é€‰å¸–å­
      function filterPosts() {
        let filteredPosts = forumPosts;

        if (currentCategory !== 'all') {
          filteredPosts = forumPosts.filter(post => post.category === currentCategory);
        }

        // æ’åº
        switch(currentSort) {
          case 'latest':
            filteredPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
            break;
          case 'popular':
            filteredPosts.sort((a, b) => b.replies - a.replies);
            break;
          case 'oldest':
            filteredPosts.sort((a, b) => new Date(a.date) - new Date(b.date));
            break;
        }

        displayPosts(filteredPosts);
      }

      // æ˜¾ç¤ºå‘å¸–è¡¨å•
      function showNewPostForm() {
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        if (!isLoggedIn) {
          alert('è¯·å…ˆç™»å½•åå†å‘å¸–');
          window.location.href = 'login-page.html';
          return;
        }

        document.getElementById('newPostForm').style.display = 'block';
        document.getElementById('newPostBtn').style.display = 'none';
        document.getElementById('postTitle').focus();
      }

      // éšè—å‘å¸–è¡¨å•
      function hideNewPostForm() {
        document.getElementById('newPostForm').style.display = 'none';
        document.getElementById('newPostBtn').style.display = 'inline-block';
        document.getElementById('postForm').reset();
      }

      // å‘è¡¨æ–°å¸–
      function submitPost(event) {
        event.preventDefault();

        const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
        const title = document.getElementById('postTitle').value;
        const content = document.getElementById('postContent').value;
        const category = document.getElementById('postCategory').value;

        if (!title || !content || !category) {
          showMessage('è¯·å¡«å†™å®Œæ•´çš„å¸–å­ä¿¡æ¯', 'error');
          return;
        }

        const newPost = {
          id: forumPosts.length + 1,
          title: title,
          content: content,
          author: userInfo.username || 'åŒ¿åç”¨æˆ·',
          category: category,
          date: new Date().toISOString().split('T')[0],
          replies: 0,
          views: 1,
          likes: 0
        };

        forumPosts.unshift(newPost);
        hideNewPostForm();
        filterPosts();
        showMessage('å¸–å­å‘è¡¨æˆåŠŸï¼', 'success');
      }

      // æŸ¥çœ‹å¸–å­è¯¦æƒ…
      function viewPost(postId) {
        const post = forumPosts.find(p => p.id === postId);
        if (post) {
          post.views++;
          alert(`å¸–å­è¯¦æƒ…\n\næ ‡é¢˜ï¼š${post.title}\nä½œè€…ï¼š${post.author}\nå‘å¸ƒæ—¶é—´ï¼š${post.date}\nåˆ†ç±»ï¼š${categoryText[post.category]}\n\nå†…å®¹ï¼š\n${post.content}\n\næµè§ˆï¼š${post.views} | å›å¤ï¼š${post.replies} | ç‚¹èµï¼š${post.likes}`);
          filterPosts(); // æ›´æ–°æµè§ˆæ•°
        }
      }

      // ç‚¹èµå¸–å­
      function likePost(postId) {
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        if (!isLoggedIn) {
          alert('è¯·å…ˆç™»å½•åå†ç‚¹èµ');
          return;
        }

        const post = forumPosts.find(p => p.id === postId);
        if (post) {
          post.likes++;
          filterPosts();
          showMessage('ç‚¹èµæˆåŠŸï¼', 'success');
        }
      }

      // å›å¤å¸–å­
      async function replyPost(postId) {
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        if (!isLoggedIn) {
          alert('è¯·å…ˆç™»å½•åå†å›å¤');
          return;
        }

        const reply = prompt('è¯·è¾“å…¥å›å¤å†…å®¹ï¼š');
        if (reply && reply.trim()) {
          const post = forumPosts.find(p => p.id === postId);
          if (post) {
            post.replies++;
            filterPosts();
            showMessage('å›å¤æˆåŠŸï¼', 'success');

            // å‘é€å›å¤é€šçŸ¥é‚®ä»¶ç»™å¸–å­ä½œè€…
            try {
              await sendForumReplyNotification(post, reply);
            } catch (error) {
              console.error('å‘é€å›å¤é€šçŸ¥é‚®ä»¶å¤±è´¥:', error);
              // ä¸å½±å“å›å¤åŠŸèƒ½ï¼Œåªæ˜¯é‚®ä»¶é€šçŸ¥å¤±è´¥
            }
          }
        }
      }

      // æ›´æ–°è®ºå›ç»Ÿè®¡
      function updateForumStats() {
        document.getElementById('totalPosts').textContent = forumPosts.length;

        const today = new Date().toISOString().split('T')[0];
        const todayPosts = forumPosts.filter(post => post.date === today).length;
        document.getElementById('todayPosts').textContent = todayPosts;
      }

      // å‘é€è®ºå›å›å¤é€šçŸ¥é‚®ä»¶
      async function sendForumReplyNotification(post, replyContent) {
        try {
          // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
          const currentUser = localStorage.getItem('username') || 'åŒ¿åç”¨æˆ·';

          // æ¨¡æ‹Ÿè·å–å¸–å­ä½œè€…é‚®ç®±ï¼ˆå®é™…åº”ç”¨ä¸­åº”è¯¥ä»ç”¨æˆ·æ•°æ®åº“è·å–ï¼‰
          const authorEmail = getAuthorEmail(post.author);

          if (!authorEmail) {
            console.log('å¸–å­ä½œè€…é‚®ç®±æœªæ‰¾åˆ°ï¼Œè·³è¿‡é‚®ä»¶é€šçŸ¥');
            return;
          }

          // å‘é€é‚®ä»¶
          const response = await fetch(`${EMAIL_API_BASE}/send`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              email: authorEmail,
              email_type: 'forum_reply',
              username: post.author,
              user_id: null,
              forum_data: {
                post_title: post.title,
                post_author: post.author,
                reply_author: currentUser,
                reply_content: replyContent,
                post_url: `${window.location.origin}/forum.html#post-${post.id}`
              }
            })
          });

          const result = await response.json();

          if (response.ok) {
            console.log('âœ… è®ºå›å›å¤é€šçŸ¥é‚®ä»¶å‘é€æˆåŠŸ');
          } else {
            throw new Error(result.error || 'é‚®ä»¶å‘é€å¤±è´¥');
          }

        } catch (error) {
          console.error('âŒ å‘é€è®ºå›å›å¤é€šçŸ¥é‚®ä»¶æ—¶å‡ºé”™:', error);
          throw error;
        }
      }

      // è·å–ä½œè€…é‚®ç®±ï¼ˆæ¨¡æ‹Ÿå‡½æ•°ï¼‰
      function getAuthorEmail(authorName) {
        // æ¨¡æ‹Ÿä½œè€…é‚®ç®±æ˜ å°„ï¼ˆå®é™…åº”ç”¨ä¸­åº”è¯¥ä»æ•°æ®åº“è·å–ï¼‰
        const authorEmails = {
          'è¯»ä¹¦çˆ±å¥½è€…': '1298934616@qq.com',
          'ä¹¦è™«å°ç‹': '1298934616@qq.com',
          'æ–‡å­¦é’å¹´': '1298934616@qq.com',
          'ç§‘æŠ€è¿·': '1298934616@qq.com',
          'å†å²å­¦è€…': '1298934616@qq.com'
        };

        return authorEmails[authorName] || null;
      }

      // æ˜¾ç¤ºæ¶ˆæ¯
      function showMessage(message, type = 'info') {
        const output = document.getElementById('form-output-global');
        const alertClass = type === 'success' ? 'alert-success' :
                          type === 'error' ? 'alert-danger' : 'alert-info';

        output.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
        output.style.display = 'block';

        setTimeout(() => {
          output.style.display = 'none';
        }, 3000);
      }

      // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
      function checkUserStatus() {
        console.log('ğŸ” æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ - è®ºå›é¡µé¢');

        const authToken = localStorage.getItem('authToken') || localStorage.getItem('token');
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        const userInfoStr = localStorage.getItem('userInfo');
        const username = localStorage.getItem('username');

        console.log('ç™»å½•æ•°æ®:', { authToken: !!authToken, isLoggedIn, userInfoStr: !!userInfoStr, username });

        const userMenu = document.getElementById('userMenu');
        const userDisplayName = document.getElementById('userDisplayName');
        const userDropdown = document.getElementById('userDropdown');

        if (!userMenu || !userDisplayName) {
          console.error('âŒ ç”¨æˆ·èœå•å…ƒç´ æœªæ‰¾åˆ°');
          return;
        }

        let userInfo = {};
        if (userInfoStr) {
          try {
            userInfo = JSON.parse(userInfoStr);
          } catch (error) {
            console.error('âŒ è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
          }
        }

        // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•ï¼ˆå¤šé‡æ£€æŸ¥ï¼‰
        const hasValidLogin = (
          (authToken && authToken !== 'null') &&
          (isLoggedIn === 'true') &&
          (userInfo.username || username)
        );

        console.log('ç™»å½•çŠ¶æ€åˆ¤æ–­:', hasValidLogin);

        if (hasValidLogin) {
          // ç”¨æˆ·å·²ç™»å½•
          const displayName = userInfo.username || username || 'ç”¨æˆ·';
          console.log('âœ… ç”¨æˆ·å·²ç™»å½•:', displayName);

          userDisplayName.textContent = displayName;
          userMenu.href = '#';

          // ç»‘å®šä¸‹æ‹‰èœå•äº‹ä»¶
          userMenu.onclick = function(e) {
            e.preventDefault();
            toggleUserDropdown();
          };
        } else {
          // ç”¨æˆ·æœªç™»å½•
          console.log('âŒ ç”¨æˆ·æœªç™»å½•');
          userDisplayName.textContent = 'ç™»å½•';
          userMenu.href = 'login-page.html';
          userMenu.onclick = null;

          if (userDropdown) {
            userDropdown.style.display = 'none';
          }
        }
      }

      // åˆ‡æ¢ç”¨æˆ·ä¸‹æ‹‰èœå•
      function toggleUserDropdown() {
        const userDropdown = document.getElementById('userDropdown');
        if (userDropdown.style.display === 'none' || !userDropdown.style.display) {
          userDropdown.style.display = 'block';
        } else {
          userDropdown.style.display = 'none';
        }
      }

      // æ³¨é”€åŠŸèƒ½
      function logout() {
        if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
          localStorage.removeItem('userInfo');
          localStorage.removeItem('isLoggedIn');
          checkUserStatus();
          showMessage('å·²æˆåŠŸé€€å‡ºç™»å½•', 'info');
        }
      }

      // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
      window.addEventListener('load', function() {
        checkUserStatus();
        displayPosts();

        // ç»‘å®šäº‹ä»¶
        document.getElementById('postForm').addEventListener('submit', submitPost);

        // åˆ†ç±»ç­›é€‰
        document.querySelectorAll('.category-link').forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();

            // ç§»é™¤æ‰€æœ‰activeç±»
            document.querySelectorAll('.category-link').forEach(l => l.classList.remove('active'));
            // æ·»åŠ activeç±»åˆ°å½“å‰é“¾æ¥
            this.classList.add('active');

            currentCategory = this.dataset.category;
            document.getElementById('forumTitle').textContent = categoryText[currentCategory];
            filterPosts();
          });
        });

        // æ’åºç­›é€‰
        document.getElementById('sortSelect').addEventListener('change', function() {
          currentSort = this.value;
          filterPosts();
        });

        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
        document.addEventListener('click', function(e) {
          const userDropdown = document.getElementById('userDropdown');
          const userMenu = document.getElementById('userMenu');

          if (!userMenu.contains(e.target) && !userDropdown.contains(e.target)) {
            userDropdown.style.display = 'none';
          }
        });
      });

      // æ›´æ–°è´­ç‰©è½¦è®¡æ•°ï¼ˆå…¨å±€å‡½æ•°ï¼‰
      window.updateCartCount = async function() {
        console.log('ğŸ” è¯»è€…è®ºå›é¡µé¢ - å¼€å§‹æ›´æ–°è´­ç‰©è½¦è®¡æ•°');

        const authToken = localStorage.getItem('authToken') || localStorage.getItem('token');
        if (!authToken) {
          console.log('âŒ æœªç™»å½•ï¼Œæ˜¾ç¤º0');
          // æœªç™»å½•æ—¶æ˜¾ç¤º0
          const cartCount = document.getElementById('cartCount');
          if (cartCount) {
            cartCount.textContent = '0';
          }
          return;
        }

        try {
          console.log('ğŸ”Œ è°ƒç”¨è´­ç‰©è½¦API');
          const response = await fetch('http://1.94.203.175:5000/api/order/cart', {
            headers: {
              'Authorization': `Bearer ${authToken}`
            }
          });

          if (response.ok) {
            const result = await response.json();
            const cartCount = document.getElementById('cartCount');
            console.log('ğŸ“¦ APIå“åº”:', result);

            if (cartCount && result.data && result.data.items) {
              const totalItems = result.data.items.reduce((sum, item) => sum + item.quantity, 0);
              cartCount.textContent = totalItems;
              console.log('âœ… è¯»è€…è®ºå›é¡µé¢è´­ç‰©è½¦è®¡æ•°å·²æ›´æ–°:', totalItems);
            } else if (cartCount) {
              cartCount.textContent = '0';
              console.log('ğŸ“¦ è´­ç‰©è½¦ä¸ºç©ºï¼Œæ˜¾ç¤º0');
            }
          } else {
            console.log('âš ï¸ è·å–è´­ç‰©è½¦æ•°æ®å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
            const cartCount = document.getElementById('cartCount');
            if (cartCount) {
              cartCount.textContent = '0';
            }
          }
        } catch (error) {
          console.error('âŒ æ›´æ–°è´­ç‰©è½¦è®¡æ•°å¤±è´¥:', error);
          // å‡ºé”™æ—¶ä¹Ÿæ˜¾ç¤º0
          const cartCount = document.getElementById('cartCount');
          if (cartCount) {
            cartCount.textContent = '0';
          }
        }
      };

      // é¡µé¢åŠ è½½æ—¶æ›´æ–°è´­ç‰©è½¦è®¡æ•°
      document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸ“„ è¯»è€…è®ºå›é¡µé¢DOMåŠ è½½å®Œæˆ');
        updateCartCount();
      });

      // é¡µé¢å®Œå…¨åŠ è½½åæ›´æ–°
      window.addEventListener('load', function() {
        console.log('ğŸ“„ è¯»è€…è®ºå›é¡µé¢å®Œå…¨åŠ è½½å®Œæˆ');
        updateCartCount();
      });

      // å»¶è¿Ÿæ›´æ–°è´­ç‰©è½¦è®¡æ•°
      setTimeout(() => {
        console.log('â° å»¶è¿Ÿ2ç§’æ›´æ–°è´­ç‰©è½¦è®¡æ•°');
        updateCartCount();
      }, 2000);

      setTimeout(() => {
        console.log('â° å»¶è¿Ÿ5ç§’æ›´æ–°è´­ç‰©è½¦è®¡æ•°');
        updateCartCount();
      }, 5000);
    </script>

    <!-- Forum Styles -->
    <style>
      .forum-sidebar {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .forum-sidebar h5 {
        margin-bottom: 15px;
        color: #333;
        font-weight: 600;
      }

      .forum-categories {
        list-style: none;
        padding: 0;
        margin-bottom: 30px;
      }

      .forum-categories li {
        margin-bottom: 8px;
      }

      .category-link {
        display: block;
        padding: 10px 15px;
        color: #666;
        text-decoration: none;
        border-radius: 4px;
        transition: all 0.3s;
      }

      .category-link:hover,
      .category-link.active {
        background: #007bff;
        color: white;
        text-decoration: none;
      }

      .forum-stats {
        border-top: 1px solid #dee2e6;
        padding-top: 20px;
      }

      .forum-stats h6 {
        margin-bottom: 15px;
        color: #333;
        font-weight: 600;
      }

      .stat-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .stat-label {
        color: #666;
      }

      .stat-value {
        color: #007bff;
        font-weight: 600;
      }

      .card {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .card-header {
        background: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        padding: 20px;
      }

      .card-header h5 {
        margin: 0;
        color: #333;
      }

      .card-body {
        padding: 20px;
      }

      .form-actions {
        margin-top: 20px;
        text-align: right;
      }

      .form-actions .button {
        margin-left: 10px;
      }

      .forum-header {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }

      .forum-header h4 {
        margin: 0;
        color: #333;
      }

      .forum-sort {
        display: flex;
        align-items: center;
        margin-top: 10px;
      }

      .forum-sort label {
        margin-right: 10px;
        color: #666;
        font-size: 14px;
      }

      .forum-sort select {
        padding: 6px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .post-item {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        margin-bottom: 20px;
        overflow: hidden;
        transition: box-shadow 0.3s;
      }

      .post-item:hover {
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }

      .post-header {
        background: #f8f9fa;
        padding: 15px 20px;
        border-bottom: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .post-category {
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 500;
      }

      .category-review {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .category-discussion {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .category-complaint {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .category-suggestion {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .post-meta {
        display: flex;
        gap: 15px;
        font-size: 14px;
        color: #666;
      }

      .post-meta i {
        margin-right: 5px;
      }

      .post-content {
        padding: 20px;
      }

      .post-title {
        margin-bottom: 10px;
      }

      .post-title a {
        color: #333;
        text-decoration: none;
        font-weight: 600;
      }

      .post-title a:hover {
        color: #007bff;
        text-decoration: none;
      }

      .post-excerpt {
        color: #666;
        line-height: 1.6;
        margin: 0;
      }

      .post-footer {
        padding: 15px 20px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .post-stats {
        display: flex;
        gap: 20px;
      }

      .post-stats .stat-item {
        display: flex;
        align-items: center;
        font-size: 14px;
        color: #666;
      }

      .post-stats .stat-item i {
        margin-right: 5px;
      }

      .post-actions {
        display: flex;
        gap: 10px;
      }

      .btn-action {
        background: none;
        border: 1px solid #ddd;
        padding: 6px 12px;
        border-radius: 4px;
        color: #666;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .btn-action:hover {
        background: #007bff;
        color: white;
        border-color: #007bff;
      }

      .empty-posts {
        text-align: center;
        padding: 60px 20px;
        color: #666;
      }

      .empty-posts i {
        font-size: 48px;
        color: #ccc;
        margin-bottom: 20px;
      }

      .empty-posts h5 {
        margin-bottom: 10px;
        color: #333;
      }

      .empty-posts p {
        margin-bottom: 20px;
      }

      /* User dropdown styles */
      .rd-navbar-user {
        position: relative;
      }

      .user-icon {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #333;
        text-decoration: none;
        padding: 8px 12px;
        border-radius: 4px;
        transition: background 0.3s;
      }

      .user-icon:hover {
        background: #f8f9fa;
        text-decoration: none;
        color: #333;
      }

      .user-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        min-width: 150px;
        z-index: 1000;
      }

      .user-dropdown a {
        display: block;
        padding: 10px 15px;
        color: #333;
        text-decoration: none;
        border-bottom: 1px solid #eee;
        transition: background 0.3s;
      }

      .user-dropdown a:last-child {
        border-bottom: none;
      }

      .user-dropdown a:hover {
        background: #f8f9fa;
        text-decoration: none;
      }

      /* Shopping cart styles */
      .rd-navbar-cart {
        margin-left: 15px;
      }

      .cart-icon {
        position: relative;
        color: #333;
        text-decoration: none;
        padding: 8px;
        border-radius: 4px;
        transition: background 0.3s;
      }

      .cart-icon:hover {
        background: #f8f9fa;
        text-decoration: none;
        color: #333;
      }

      .cart-count {
        position: absolute;
        top: 0;
        right: 0;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translate(50%, -50%);
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .forum-header {
          flex-direction: column;
          align-items: stretch;
        }

        .forum-header h4 {
          margin-bottom: 15px;
        }

        .forum-sort {
          justify-content: space-between;
          margin-top: 0;
        }

        .post-header {
          flex-direction: column;
          align-items: stretch;
          gap: 10px;
        }

        .post-footer {
          flex-direction: column;
          align-items: stretch;
          gap: 15px;
        }

        .post-stats {
          justify-content: space-around;
        }

        .post-actions {
          justify-content: center;
        }
      }
    </style>
